<!DOCTYPE html>
<html lang='en'>
   <head>
      <meta charset='utf-8'>
      <title>Elasticsearch UI (by Calaca)</title>
      <link rel='stylesheet' type='text/css' href='css/reset.css'>
      <link rel='stylesheet' type='text/css' href='css/calaca.css'>
      <link rel="stylesheet" type='text/css' href="bower_components/angular-window-manager/window-manager.css">
      <script src='bower_components/jquery/dist/jquery.min.js' type='text/javascript'></script>    
      <script src='bower_components/angular/angular.min.js' type='text/javascript'></script>
      <!--[if IE]>
      <script src='http://html5shiv.googlecode.com/svn/trunk/html5.js'></script>
      <![endif]-->
   </head>
   <body  ng-app='calaca' ng-controller='calacaCtrl'>
      <!-- Title and search box -->
      <header class='jumbotron'>
         <h1 class='title'>Vertical Search Engine</h1>
         <br>
         <p style="text-align: center; color: rgb(21, 72, 129);">
            [ Articles about US Immigration ]
         </p>
         <div class='search-box-container'>
            <form id="myForm">
               <input id="query_content" type='text' class='search-box' placeholder='Query' autofocus ng-model='query' ng-change='delayedSearch(0)'><br> 
               <p style="text-align: center;">&nbsp;Input or try query:&nbsp;&nbsp;
                  <input type="radio" id="query1" name="query_words" value="Immigration Order Obama" onclick="updateInputBox(this.value)">
                  <label for="query1">Immigration Order Obama</label> &nbsp;
                  <input type="radio" id="query2" name="query_words" value="Immigration 20th Century" onclick="updateInputBox(this.value)">
                  <label for="query2">Immigration 20th Century</label> &nbsp;
                  <input type="radio" id="query3" name="query_words" value="Illegal Immigration" onclick="updateInputBox(this.value)">
                  <label for="query3">Illegal Immigration</label>
                  <br><br>
                  <p style="text-align: center; color: rgb(106, 136, 192);">(add a white space if result doesn't come up right away)</style></p>
               </p>
            </form>
         </div>

      </header>
      <div class='rank-window-toolbar'>
         <!-- <button onclick="countLines()">Count</button>&nbsp
         <button onclick="myFunction()">Copy</button> -->
         <div class='zero'>
            <textarea id='rank-results'  ng-model='rank'></textarea>
         </div>
      </div>
      <!-- </span> -->
      <div class='rank-results-container'>
         <table class=''>
            <thead>
               <tr>
                  <th>QueryID</th>
                  <th>AssessorID</th>
                  <th>DocID</th>
                  <th>Grade</th>
               </tr>
            </thead>
            <tbody ng-repeat='(q, r) in ranking'>
               <tr class='result' ng-repeat='(u, s) in r'>
                  <td> {{q}}</td>
                  <td> kaiyuan wei</td>
                  <td> {{u}}</td>
                  <td> {{s}}</td>
               </tr>
               <!-- END: Custom display results -->      
            </tbody>
         </table>
      </div>
      <!-- Listing of search results -->
      <main class='results-container' ng-cloak>
         <!-- <section class='rank-window'>
      
         </section> -->
         <table style="width: 100%; height: 400px;" ng-col-resizeable>
            <tr>
               <td style='vertical-align: top'>
               	<div class='results-preview'>
               		<iframe name='page-preview' src='' class='page-preview' scrolling="auto">
               		</iframe>
               	</div>
               </td>
               <td style='vertical-align: top; width:35%; border-style: solid'>

                  <section class='results'>
                     <p class='no-results' ng-show='!results.length && !loading'>Search Result</p>
                     <article class='result' ng-repeat='result in results track by $id(result)'>
                        <!-- START: Custom display results -->
                        <a href="{{result._id}}" target='page-preview'>
                           <h2>{{result.TITLE}}</h2>
                        <cite>{{result._id}}</cite></a>
                        <!-- <form class='evals'>
                           <span ng-repeat='i in [2,1,0]'>
                           <input type='radio' name='rank' value='{{i}}' doc='{{result._id}}' 
                              ng-click='setScore(this.this.result._id, this.i)'
                              ng-checked='this.this.ranking[query][this.this.result._id] == this.i'> {{i}}
                           </input>
                           </span>
                        </form> -->
                        <p>
                           <span ng-repeat='highlight in result.highlight.TEXT track by $index' ng-bind-html-unsafe='highlight'>
                           <span ng-bind-html="highlight"></span>&nbsp; ... &nbsp;
                           </span>
                        </p>
                     </article>
                  </section>

               </td>
            </tr>
            <br >
            <!-- <tr>
               <section class='function-button'>
                  <button onclick="countLines()">Count</button>&nbsp &nbsp &nbsp
                  <button onclick="myFunction()">Copy</button>&nbsp &nbsp &nbsp
                  <button onclick="saveToFile()">Save</button>
               </section>
            </tr> -->
         </table>

      </main>
      <!-- Load resources -->
      <script src='bower_components/angular-sanitize/angular-sanitize.min.js' type='text/javascript'></script>
      <script src='bower_components/angular-animate/angular-animate.min.js' type='text/javascript'></script>
      <script src='bower_components/elasticsearch/elasticsearch.angular.min.js' type='text/javascript'></script>
      <script src="bower_components/angular-window-manager/angular-window-manager.js" type='text/javascript'></script>
      <script src="https://cdn.rawgit.com/zenorocha/clipboard.js/master/dist/clipboard.min.js"></script>
      <script src="bower_components/ngclipboard/dist/ngclipboard.min.js"></script>
      <script src="bower_components/colresizable/colResizable-1.6.min.js"></script>
      <script src='js/config.js' type='text/javascript'></script>
      <script src='js/app.js' type='text/javascript'></script>
      <script src='js/controllers.js' type='text/javascript'></script>
      <script src='js/services.js' type='text/javascript'></script>
   </body>

   <!-- Script --> 
   <script>

      function myFunction() {
        // Get the text field
        var copyText = document.getElementById("rank-results");
         
        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices
      
        // Copy the text inside the text field
        navigator.clipboard.writeText(copyText.value);
      
        // Alert the copied text
        alert("Copy done.");
      }

      function countLines() {
			var textarea = document.getElementById("rank-results");
			var lines = textarea.value.split("\n").length - 1;
			alert(lines + " docs graded");
		}

      function updateInputBox(value) {
         document.getElementById('query_content').value = value;
      }

      function saveToFile() {
        // Get the string to save
        var string = document.getElementById("rank-results").value;

        // Create a new Blob object with the string and specify the MIME type
        var blob = new Blob([string], { type: "text/plain" });

        // Create a new File object from the Blob
        var file = new File([blob], "qrel.txt");

        // Create a new URL object and use it to create a download link
        var url = URL.createObjectURL(file);
        var link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", file.name);

        // Simulate a click on the download link
        link.click();

        // Clean up the URL object
        URL.revokeObjectURL(url);
      }

      // }

   </script>

</html>